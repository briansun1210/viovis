<!DOCTYPE html>
<html lang="en">
	<head>
        <link rel="stylesheet" href="../css/US_map.css" />
		<meta charset="utf-8">
		<title>D3: Stack layout stacked bar chart</title>
        
		<script type="text/javascript" src="https://d3js.org/d3.v6.min.js"></script>
		<style type="text/css">    
		</style>
	</head>
	<body classname = 'LineGraph'> 
		<script type="text/javascript">



            d3.csv("../data/policekillings.csv")
			.then(function(csv) {
                

				var data_obj = Array.from(csv, x => ({ race: x["Victim's race"],
                                                        city: x["City"],
                                                        state: x["State"],
														year: x["Date of Incident (month/day/year)"].slice(-4)
				}));
                

                var state_obj = {}
                data_obj.forEach((i) => {
                    
                    if (!state_obj[i.state]){
                        var bTotal = data_obj.filter(function(d, j) { return (d.race === "Black" && d.city === i.city); }).length;
                        var aTotal = data_obj.filter(function(d, j) { return (d.city === i.city); }).length;
                        state_obj[i.state] = [{city: i.city, blackkill: bTotal, allKill: aTotal}]
                    }
                    else {
                        if (state_obj[i.state].filter(a => a.city === i.city).length === 0){
                            var bTotal = data_obj.filter(function(d, j) { return (d.race === "Black" && d.city === i.city); }).length;
                            var aTotal = data_obj.filter(function(d, j) { return (d.city === i.city); }).length;
                            state_obj[i.state].push({city: i.city, bKill: bTotal, allKill: aTotal})
                        }
                    }
                    
                });


                for (var i in state_obj) {
                    state_obj[i].sort((a, b) => {
                        return b.bKill - a.bKill;
                    });
                    console.log(typeof(state_obj[i]))

                    // console.log(state_obj[i].slice(0,10))
                    state_obj[i] = state_obj[i].slice(0,10)
                    
                }

                console.log(state_obj["MA"])



                var margin = {top: 20, right: 160, bottom: 35, left: 30};

                var width = 960 - margin.left - margin.right,
                    height = 500 - margin.top - margin.bottom;

                var svg = d3.select("body")
                    .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

                var dataset = d3.stack()(["bKill", "allKill"].map(function(fruit) {
                    return state_obj["MA"].map(function(d) {
                        console.log({x: d.city, y: d[fruit]})
                        return {x: d.city, y: +d[fruit]};
                    });
                }));

                // Set x, y and colors
                var x = d3.scaleOrdinal()
                    .domain(dataset[0].map(function(d) { return d.x; }))
                    .rangeRoundBands([10, width-10], 0.02);

                // var y = d3.scale.linear()
                //     .domain([0, d3.max(dataset, function(d) {  return d3.max(d, function(d) { return d.y0 + d.y; });  })])
                //     .range([height, 0]);




















                
                

                // var w = 500;
                // var h = 300;
                // var stack = d3.stack().keys(["bKill", "allKill"]);
                // var series = stack(state_obj["MA"]);

                // var xScale = d3.scaleBand()
                //     .domain(d3.range(state_obj["MA"].length))
                //     .range([0, w])
                //     .paddingInner(0.05);

                // var yScale = d3.scaleLinear()
                //     .domain([0,				
                //         d3.max(state_obj["MA"], function(d) {
                //             return d.bKill + d.allKill;
                //         })
                //     ])
                //     .range([0, h]);

                //     //Easy colors accessible via a 10-step ordinal scale
                // var colors = d3.scaleOrdinal(d3.schemeCategory10);
		
                // //Create SVG element
                // var svg = d3.select("body")
                //     .append("svg")
                //     .attr("width", w)
                //     .attr("height", h);

                // // Add a group for each row of data
                // var groups = svg.selectAll("g")
                //     .data(series)
                //     .enter()
                //     .append("g")
                //     .style("fill", function(d, i) {
                //         return colors(i);
                //     });

                // // Add a rect for each data value
                // var rects = groups.selectAll("rect")
                //     .data(function(d) { return d; })
                //     .enter()
                //     .append("rect")
                //     .attr("x", function(d, i) {
                //         return xScale(i);
                //     })
                //     .attr("y", function(d) {
                //         return yScale(d[0]);
                //     })
                //     .attr("height", function(d) {
                //         return yScale(d[1]) - yScale(d[0]);
                //     })
                //     .attr("width", xScale.bandwidth());







            });
               
                        
				
										
		</script>
	</body>
</html>