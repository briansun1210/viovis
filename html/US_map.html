<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<title>map</title>
	<link rel="shortcut icon" href="#">
	<script type="text/javascript" src="https://d3js.org/d3.v6.min.js"></script>
	<script type="text/javascript" src="https://d3js.org/topojson.v3.min.js"></script>
	<link rel="stylesheet" href="../css/US_map.css" />
	<style type="text/css">
	</style>
</head>

<body>
	<script type="text/javascript">
		var proj_state = d3.geoAlbers().scale([1000]);
		var path_state = d3.geoPath().projection(proj_state);

		var spider_div = d3.select("body")
							.append("div")
							.attr("class", "tooltip")
							.style("opacity", 0);
		
		var svg = d3.select("body")
					.append("svg")
					.attr("width", 1000)
					.attr("height", 500);
					
		<!-- TODO: don't forget to include alaska and hawaii who are currently cut off -->
		d3.json("https://gist.githubusercontent.com/mbostock/4090846/raw/d534aba169207548a8a3d670c9c2cc719ff05c47/us.json")
			.then(function(json) {
				d3.csv("../data/killingsbystate.csv")
					.then(function(csv) {
						var totals = Array.from(csv, x => parseInt(x["# People Killed"]));
						var stateScale = d3.scalePow()
											 .exponent(0.33)
											 .domain([0, d3.max(totals, function(d) { return d; })])
											 .range(["#d6edff", "#0a4a7d"]);
						//console.log(totals);
						var ids = Array.from(topojson.feature(json, json.objects.states).features, x => x["id"]);
						//console.log(topojson.feature(json, json.objects.states));
						var features = topojson.feature(json, json.objects.states).features;
						features.sort((a, b) => (parseInt(a["id"]) < parseInt(b["id"])) ? -1 : 1);
						//console.log(features);
						svg.selectAll("path")
							.data(features)
							.enter()
							.append("path")
							.attr("d", path_state)
							.attr("x", 1000)
							.style("stroke", "#ffffff")
							.style("stroke-width", "1")
							.data(totals)
							.style("fill", function(d) {
								return stateScale(d);
							})
							.on("mouseover", function(event, d) {
								//var mouse_pos = d3.pointer(event, svg);
								d3.select(event.currentTarget).style("fill", "#222222");
								spider_div.style("opacity", 1);
								//spider_div.style("left", mouse_pos[0]+"px").style("top", mouse_pos[1]+"px");
							})
							.on("mousemove", function(event, d) {
								var mouse_pos = d3.pointer(event, svg);
								spider_div.style("left", mouse_pos[0]+"px").style("top", mouse_pos[1]+"px");
							})
							.on("mouseout", function(event, d) {
								d3.select(event.currentTarget).style("fill", function(d) {
									return stateScale(d);
								})
								//spider_div.style("opacity", 0);
							});
					});
			});
		var states = svg.selectAll("path");
	</script>
</body>

</html>